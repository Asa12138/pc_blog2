---
title: ä½¿ç”¨MetaNetæ·»åŠ æ›´å¤šèŠ‚ç‚¹å½¢çŠ¶
author: Asa
date: '2025-05-22'
slug: metanet-shape
categories:
  - R
tags:
  - network
description: MetaNetæ·»åŠ äº†æ›´å¤šçš„èŠ‚ç‚¹å½¢çŠ¶ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®æœ¬æ–‡æ–¹æ³•æ·»åŠ è‡ªå®šä¹‰å½¢çŠ¶ã€‚
image: "index.en_files/figure-html/unnamed-chunk-6-1.png"
math: ~
license: ~
hidden: no
comments: yes
---

```{r include=FALSE}
devtools::load_all("~/Documents/R/pcutils/")
devtools::load_all("~/Documents/R/MetaNet/MetaNet/")
data(otutab, package = "pcutils")
Packages <- c("dplyr", "pcutils", "kableExtra")
pcutils::lib_ps(Packages)
knitr::opts_chunk$set(message = FALSE,warning = FALSE,eval = TRUE, fig.width=8,fig.height=5)
```

MetaNeté»˜è®¤ä½¿ç”¨çš„æ˜¯`igraph`çš„ç»˜å›¾ç³»ç»Ÿï¼Œå…¶ä¸­è‡ªå¸¦çš„èŠ‚ç‚¹å½¢çŠ¶æ˜¯éå¸¸æœ‰é™çš„ï¼Œåªæœ‰`circle`ã€`square`ã€`csquare`ã€`rectangle`ã€`crectangle`ã€`vrectangle`ã€`pie`ã€`none`è¿™å‡ ç§å½¢çŠ¶ï¼ŒMetaNetåœ¨æ­¤åŸºç¡€ä¸Šæ·»åŠ äº†æ›´å¤šå¸¸ç”¨å½¢çŠ¶ï¼Œå¹¶ä¸”å¯ä»¥æ ¹æ®æœ¬æ–‡æ–¹æ³•æ·»åŠ è‡ªå®šä¹‰å½¢çŠ¶ã€‚

- è½¯ä»¶ä¸»é¡µï¼š<https://github.com/Asa12138/MetaNet> **å¤§å®¶å¯ä»¥å¸®å¿™åœ¨githubä¸Šç‚¹ç‚¹starâ­ï¸**ï¼Œè°¢è°¢ğŸ™
- è¯¦ç»†è‹±æ–‡ç‰ˆæ•™ç¨‹ï¼š<https://bookdown.org/Asa12138/metanet_book>

å¯ä»¥ä» CRAN å®‰è£…ç¨³å®šç‰ˆï¼š`install.packages("MetaNet")`  

æœ€æ–°çš„å¼€å‘ç‰ˆæœ¬å¯ä»¥åœ¨ <https://github.com/Asa12138/MetaNet> ä¸­æ‰¾åˆ°ï¼š

```r
remotes::install_github("Asa12138/MetaNet", dependencies = T)
```


## igraphèŠ‚ç‚¹å½¢çŠ¶

```{r}
library(igraph)
# all vertex shapes, minus "raster", that might not be available
# é»˜è®¤åªæœ‰ä»¥ä¸‹è¿™äº›
shapes <- c("circle","crectangle","csquare","none","pie","raster","rectangle","sphere","square","vrectangle")
g <- make_ring(length(shapes))
set.seed(42)
plot(g,
  vertex.shape = shapes, vertex.label = shapes, vertex.label.dist = 1,
  vertex.size = 15, vertex.size2 = 15,
  vertex.pie = lapply(shapes, function(x) if (x == "pie") 2:6 else 0),
  vertex.pie.color = list(heat.colors(5))
)
```

å¯ä»¥çœ‹åˆ°`csquare`ã€`rectangle`ã€`crectangle`ã€`vrectangle`ç­‰å½¢çŠ¶éƒ½æ˜¯çŸ©å½¢çš„å˜ç§ï¼Œä¸»è¦æ˜¯çº¿çš„è¿æ¥æ–¹å¼ä¸åŒï¼Œæœ‰æ—¶å€™æ˜¯éš¾ä»¥åŒºåˆ†çš„ã€‚

sphereæ˜¯ä¸€ä¸ªä¸‰ç»´çš„çƒä½“ï¼Œè¿˜æ˜¯å¾ˆå¥½çœ‹çš„ï¼Œå¯ä»¥æ¨¡æ‹ŸSTRING æ•°æ®åº“çš„èŠ‚ç‚¹å½¢çŠ¶ã€‚

```{r}
g<-make_graph("Zachary")
plot(g, vertex.shape = "sphere", vertex.label = NA,
  vertex.size = 18, vertex.color= pcutils::get_cols(4)
)
```


## MetaNetèŠ‚ç‚¹å½¢çŠ¶

MetaNetåœ¨igraphçš„åŸºç¡€ä¸Šæ·»åŠ äº†æ›´å¤šçš„å½¢çŠ¶ï¼Œä¸»è¦æ˜¯`diamond`ã€`triangle1`ã€`triangle2`ã€`star`ã€`polygon`ç­‰å½¢çŠ¶ã€‚

MetaNetçš„å½¢çŠ¶é»˜è®¤æ˜¯è·Ÿv_groupå˜é‡ç»‘å®šçš„ï¼ˆæŸ¥çœ‹ä¹‹å‰çš„æ¨æ–‡ [3.ç½‘ç»œæ³¨é‡Šä¸æ“ä½œ](../metanet-3)ï¼‰ï¼Œæ‰€ä»¥å½“è®¾å®šäº†å¤šä¸ªå¤§åˆ†ç»„æ—¶ï¼Œéœ€è¦ä¸€äº›æ˜“äºåŒºåˆ†çš„å½¢çŠ¶æ¥åŒºåˆ†ä¸åŒçš„ç»„ã€‚

é»˜è®¤çš„å½¢çŠ¶åˆ†é…æ˜¯c("circle","square","diamond","triangle1","triangle2")

```{r}
library(MetaNet)
# ç»™ä¸€äº›v_group
V(g)$v_group <- sample(paste0("Group",1:5), vcount(g), replace = TRUE)
V(g)$v_class <- sample(letters[1:3], vcount(g), replace = TRUE)
as.metanet(g)->g2
c_net_plot(g2,vertex.color= pcutils::get_cols(4))
```

ä¹Ÿå¯ä»¥æŒ‡å®š`star`ã€`ploygon`ç­‰å½¢çŠ¶ã€‚ 

```{r}
c_net_plot(g2,vertex.color= pcutils::get_cols(4),
           vertex.shape=c("star","polygon"),vertex.norays=5,
           legend = F)
```
`star`ã€`ploygon`ä¸¤ç§å½¢çŠ¶å¯ä»¥æŒ‡å®šè¾¹æ•°ï¼Œvertex.norayså‚æ•°å¯ä»¥æŒ‡å®šè¾¹æ•°ï¼Œé»˜è®¤æ˜¯5è§’æ˜Ÿå’Œ5è¾¹å½¢ã€‚

```{r}
c_net_plot(g2,vertex.color= pcutils::get_cols(4),
           vertex.shape=c("star","polygon"),
           vertex.norays=sample(4:7,vcount(g2), replace = TRUE),legend = F)
```


## æ·»åŠ è‡ªå®šä¹‰å½¢çŠ¶

`add_shape` å¯ç”¨äºå‘igraph/MetaNetæ·»åŠ æ–°çš„é¡¶ç‚¹å½¢çŠ¶ï¼Œæä¾›æ–°å½¢çŠ¶çš„å‰ªåˆ‡å’Œæ‰“å°åŠŸèƒ½å³å¯ã€‚ä¹Ÿå¯ä»¥åœ¨å‚æ•°ä¸­åˆ—å‡ºå‰ªè£å’Œ/æˆ–ç»˜å›¾å‡½æ•°å¯ä»¥ä½¿ç”¨çš„ç»˜å›¾/é¡¶ç‚¹/è¾¹å‚æ•°ã€‚

æ‹¿ä¸Šè¿°çš„staråšä¸€ä¸ªä¾‹å­ï¼Œæ„å»ºä»¥ä¸‹add_metanet_shape_starå‡½æ•°ï¼Œå¹¶è¿è¡Œåï¼Œå°±å¯ä»¥æ·»åŠ ä¸Šè¿°çš„starå½¢çŠ¶äº†ï¼Œå¹¶ä¸”æ”¯æŒcolorï¼Œsizeï¼Œframe.colorç­‰å‚æ•°çš„ä¿®æ”¹ã€‚

```{r eval=FALSE}
add_metanet_shape_star <- function() {
  mystar <- function(coords, v = NULL, params) {
    vertex.color <- params("vertex", "color")
    if (length(vertex.color) != 1 && !is.null(v)) {
      vertex.color <- vertex.color[v]
    }
    vertex.frame.color <- params("vertex", "frame.color")
    if (length(vertex.frame.color) != 1 && !is.null(v)) {
      vertex.frame.color <- vertex.frame.color[v]
    }
    vertex.frame.width <- params("vertex", "frame.width")
    if (length(vertex.frame.width) != 1 && !is.null(v)) {
      vertex.frame.width <- vertex.frame.width[v]
    }
    vertex.size <- 1 / 150 * params("vertex", "size")
    if (length(vertex.size) != 1 && !is.null(v)) {
      vertex.size <- vertex.size[v]
    }
    norays <- params("vertex", "norays")
    if (is.null(norays)) norays=5
    if (length(norays) != 1 && !is.null(v)) {
      norays <- norays[v]
    }

    # å¤„ç†è¾¹æ¡†å®½åº¦å’Œé¢œè‰²
    vertex.frame.color[vertex.frame.width <= 0] <- NA
    vertex.frame.width[vertex.frame.width <= 0] <- 1 # é¿å…å®½åº¦ä¸º0

    mapply(coords[, 1], coords[, 2], vertex.color, vertex.frame.color,
           vertex.size, vertex.frame.width, norays,
           FUN = function(x, y, bg, fg, size, lwd, nor) {
             symbols(
               x = x, y = y, bg = bg, fg = fg, lwd = lwd,
               stars = matrix(c(size, size / 2), nrow = 1, ncol = nor * 2), add = TRUE, inches = FALSE
             )
           }
    )
  }
  igraph::add_shape("star", clip = igraph::shape_noclip, plot = mystar)
}
add_metanet_shape_star()
```

æˆ‘ä»¬å½“ç„¶ä¹Ÿå¯ä»¥ç»˜åˆ¶å„ç§å¥‡æ€ªçš„å¤šè¾¹å½¢ï¼š

```{r eval=FALSE}
  new_polygon <- function(coords, v = NULL, params) {
    vertex.color <- params("vertex", "color")
    if (length(vertex.color) != 1 && !is.null(v)) {
      vertex.color <- vertex.color[v]
    }
    vertex.frame.color <- params("vertex", "frame.color")
    if (length(vertex.frame.color) != 1 && !is.null(v)) {
      vertex.frame.color <- vertex.frame.color[v]
    }
    vertex.frame.width <- params("vertex", "frame.width")
    if (length(vertex.frame.width) != 1 && !is.null(v)) {
      vertex.frame.width <- vertex.frame.width[v]
    }
    vertex.size <- 1 / 200 * params("vertex", "size")
    if (length(vertex.size) != 1 && !is.null(v)) {
      vertex.size <- vertex.size[v]
    }
    norays <- params("vertex", "norays")
    if (is.null(norays)) norays=5
    if (length(norays) != 1 && !is.null(v)) {
      norays <- norays[v]
    }

    weird_polygon_coords <- function(x, y, size) {
      theta <- seq(0, 2 * pi, length.out = 7)[-7]  # 6ä¸ªé¡¶ç‚¹
      # æ¯ä¸ªé¡¶ç‚¹çš„åŠå¾„éšæœºå˜åŒ–ï¼ˆsize çš„ 0.5~1.5 å€ï¼‰
      random_size <- size * runif(6, min = 0.5, max = 1.5)
      x_coords <- x + random_size * cos(theta)
      y_coords <- y + random_size * sin(theta)
      list(x = x_coords, y = y_coords)
    }

    # å¤„ç†è¾¹æ¡†å®½åº¦å’Œé¢œè‰²
    vertex.frame.color[vertex.frame.width <= 0] <- NA
    vertex.frame.width[vertex.frame.width <= 0] <- 1

    mapply(coords[, 1], coords[, 2], vertex.color, vertex.frame.color,
      vertex.size, vertex.frame.width,
      FUN = function(x, y, bg, fg, size, lwd) {
        coords <- weird_polygon_coords(x, y, size)
        polygon(coords$x, coords$y, col = bg, border = fg, lwd = lwd)
      }
    )
  }
  igraph::add_shape("new_polygon", clip = igraph::shape_noclip, plot = new_polygon)
```


ç„¶åç”¨ç”¨æˆ‘ä»¬æ–°å®šä¹‰çš„éšæœºå¥‡æ€ªå¤šè¾¹å½¢æ¥ç»˜åˆ¶ç½‘ç»œå›¾ï¼š

```{r eval=FALSE}
c_net_plot(g2,vertex.color= pcutils::get_cols(4),
           vertex.shape=c("new_polygon"),
           legend = F)
```

![](images/newpoly.png)

æ³¨æ„ï¼Œæœ€å¥½æ˜¯ç”¨symbols()æˆ–è€…polygon()å‡½æ•°æ¥ç»˜åˆ¶å½¢çŠ¶ï¼Œå…¶ä»–çš„ç»˜å›¾å‡½æ•°æ¯”å¦‚points()ä¹Ÿå¯ä»¥è¿™æ ·æ·»åŠ å½¢çŠ¶ï¼Œä½†æ˜¯è¿™æ ·æ·»åŠ çš„å½¢çŠ¶å¤§å°ç¼©æ”¾çš„é€»è¾‘å’Œé»˜è®¤å½¢çŠ¶çš„ä¸ä¸€è‡´ï¼Œæ‰€ä»¥æˆ‘æœ€åä¹Ÿæ˜¯æ”¾å¼ƒäº†æ”¯æŒggplotå’Œgraphicsé»˜è®¤çš„å½¢çŠ¶1-25ï¼Œä½†æ„Ÿè§‰æœ‰ä¸Šè¿°è¿™äº›å¤§éƒ¨åˆ†å½¢çŠ¶ä¹Ÿå¤Ÿäº†ã€‚

