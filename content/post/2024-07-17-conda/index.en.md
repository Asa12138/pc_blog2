---
title: æ›´æ–°ä¸€ä¸‹ä½ çš„Condaå§
author: Peng Chen
date: '2024-07-17'
slug: conda
categories:
  - utils
tags:
  - utils
  - conda
description: condaä»23.10.0 ç‰ˆæœ¬å¼€å§‹é»˜è®¤æ±‚è§£å™¨æ›´æ”¹ä¸º `conda-libmamba-solver`ï¼Œé€Ÿåº¦å¿«äº†å¾ˆå¤šã€‚
image: images/conda.png
math: ~
license: ~
hidden: no
comments: yes
---

åšç”Ÿä¿¡åˆ†ææ—¶æœ‰æ—¶å€™è¦å®‰è£…å¾ˆå¤šè½¯ä»¶ï¼Œè½¯ä»¶ä¹‹é—´çš„ç‰ˆæœ¬ä¾èµ–å…³ç³»å¤æ‚ï¼Œè¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°Condaæ¥å®‰è£…è½¯ä»¶ã€‚æˆ‘ä¸€å¹´å‰ä¸‹è½½çš„condaï¼Œæœ€è¿‘æ„Ÿè§‰å®‰è£…è½¯ä»¶è¶Šæ¥è¶Šæ…¢äº†ï¼Œæœ‰è¯•è¿‡ä¸€æ®µæ—¶é—´çš„mambaï¼ˆä¸€ä¸ªå¿«é€Ÿã€å¼ºå¤§ã€è·¨å¹³å°çš„åŒ…ç®¡ç†å™¨ï¼‰ï¼Œä½†æ˜¯æŸä¸ªç‰ˆæœ¬å¼€å§‹ä¸å…¼å®¹æˆ‘å·²æœ‰çš„condaï¼Œä¼šæŠ¥é”™ï¼Œæˆ‘ä¹Ÿæ²¡æœ‰ä»”ç»†å»è§£å†³ã€‚å°±ä¸€ç›´åœ¨å¿å—ç€condaçš„æ…¢ã€‚ã€‚ã€‚

ç»ˆäºåœ¨å‰å‡ å¤©ï¼Œåœ¨å®‰è£…æµ‹è¯•å‡ ä¸ªå¤§å‹pipelineæ—¶å—ä¸äº†äº†ï¼Œå‡†å¤‡æ•´ç†ä¸€ä¸‹è‡ªå·±çš„ç¯å¢ƒï¼Œæƒ³è¯•è¯•æœ€æ–°çš„mambaã€‚ç»“æœå‘ç°condaåœ¨å»å¹´åæœˆä»½æœ‰ä¸€ä¸ªé‡å¤§æ›´æ–°ï¼Œåœ¨è¿™ä¸ª 23.10.0 ç‰ˆæœ¬ä¸­ï¼Œå°† conda çš„é»˜è®¤æ±‚è§£å™¨æ›´æ”¹ä¸º `conda-libmamba-solver`ï¼
ä»¥å‰çš„â€œç»å…¸â€æ±‚è§£å™¨åŸºäº pycosat/Picosatï¼Œå¹¶ä¸”åœ¨å¯é¢„è§çš„å°†æ¥ä»å°†æ˜¯ conda çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨åå¤‡æ–¹æ¡ˆã€‚

conda æ›´æ–°æ—¥å¿—ï¼š<https://docs.conda.io/projects/conda/en/stable/release-notes.html>

condaæ…¢å°±æ…¢åœ¨è®¡ç®—ç¯å¢ƒä¸­åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œé‚£æ¢æˆmambaæ±‚è§£å™¨ï¼Œå²‚ä¸æ˜¯å¿«å¾ˆå¤šè€Œä¸”ä¸ç ´ååŸæœ‰çš„ç¯å¢ƒï¼Ÿï¼ˆæˆ‘ä¸å–œæ¬¢æœ‰ä¸ªcondaç›®å½•åˆä¸€ä¸ªmambaç›®å½•ï¼Œä¸¤è€…çš„configä¹Ÿä¸å¤ªä¸€æ ·ï¼‰ï¼Œèµ¶ç´§è¯•è¯•ï¼š

```bash
conda -V #çœ‹çœ‹ä½ çš„condaç‰ˆæœ¬ï¼Œæ˜¯ä¸æ˜¯åœ¨23.10.0ä»¥å‰
conda clean -a #æ³¨æ„ï¼Œæˆ‘çš„ç¯å¢ƒç§¯å‹äº†å¤ªå¤šä¸œè¥¿ï¼Œcondaæ›´æ–°å‡ ä¸ªå°æ—¶éƒ½æ²¡æˆåŠŸï¼Œäºæ˜¯æ¸…ç†äº†ä¸€ä¸‹
conda update conda
conda -V #å†çœ‹çœ‹ä½ çš„condaç‰ˆæœ¬
```

äº²èº«ä½“éªŒï¼Œæ›´æ–°åçš„condaåœ¨solve environmentè¿™ä¸€æ­¥å¿«äº†éå¸¸å¤šï¼Œå‡ åˆ†é’Ÿå·¦å³ï¼ˆä¹‹å‰å¯èƒ½èŠ±ä¸Šå‡ ä¸ªå°æ—¶ğŸ˜­ï¼Œå› ä¸ºæˆ‘çš„ä¸€äº›ç¯å¢ƒå·²ç»å®‰è£…äº†ä¸å°‘è½¯ä»¶ï¼‰ã€‚

ä¸‹é¢æ˜¯condaçš„ä¸€äº›ç›¸å…³ä»‹ç»ï¼š

## Introduction

<img src="images/conda.png" title=""/>

Condaæ˜¯ä¸€ä¸ªå¼€æºçš„åŒ…ç®¡ç†å’Œç¯å¢ƒç®¡ç†å·¥å…·ï¼Œä¸»è¦ç”¨äºæ•°æ®ç§‘å­¦å’Œæœºå™¨å­¦ä¹ é¢†åŸŸã€‚å®ƒå…è®¸è½»æ¾åœ°åˆ›å»ºã€å®‰è£…ã€ç®¡ç†å’Œåˆ‡æ¢ä¸åŒç‰ˆæœ¬çš„è½¯ä»¶åŒ…å’Œä¾èµ–é¡¹ï¼Œä»¥åŠåˆ›å»ºå’Œç®¡ç†ä¸åŒçš„è™šæ‹Ÿç¯å¢ƒã€‚Condaæœ€å¸¸ç”¨äºPythonç¯å¢ƒï¼Œä½†ä¹Ÿå¯ç”¨äºå…¶ä»–ç¼–ç¨‹è¯­è¨€çš„ç¯å¢ƒç®¡ç†ã€‚(conda, mamba, python éƒ½æ˜¯è›‡ğŸçš„åå­—)

ä»¥ä¸‹æ˜¯ä¸€äº›ä¸Condaç›¸å…³çš„åŸºæœ¬æ¦‚å¿µå’Œç”¨æ³•ï¼š

1. **ç¯å¢ƒï¼ˆEnvironmentï¼‰ï¼š** åœ¨Condaä¸­ï¼Œç¯å¢ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å·¥ä½œåŒºï¼Œå…¶ä¸­åŒ…å«ç‰¹å®šç‰ˆæœ¬çš„è½¯ä»¶åŒ…å’Œå…¶ä¾èµ–é¡¹ã€‚å¯ä»¥åˆ›å»ºå¤šä¸ªç¯å¢ƒï¼Œæ¯ä¸ªç¯å¢ƒå¯ä»¥æœ‰ä¸åŒçš„è½¯ä»¶åŒ…é…ç½®ï¼Œä»¥æ»¡è¶³ä¸åŒé¡¹ç›®çš„éœ€æ±‚ã€‚

2. **è½¯ä»¶åŒ…ï¼ˆPackageï¼‰ï¼š** è½¯ä»¶åŒ…æ˜¯åœ¨Condaç¯å¢ƒä¸­å®‰è£…çš„è½¯ä»¶ç»„ä»¶ï¼Œå¯ä»¥åŒ…æ‹¬Pythonåº“ã€å·¥å…·å’Œå…¶ä»–ç¨‹åºã€‚Condaå…·æœ‰å¤§é‡çš„é¢„æ„å»ºè½¯ä»¶åŒ…ï¼Œä¹Ÿæ”¯æŒåˆ›å»ºè‡ªå®šä¹‰è½¯ä»¶åŒ…ã€‚

3. **é¢‘é“ï¼ˆChannelï¼‰ï¼š** Condaè½¯ä»¶åŒ…é€šå¸¸å­˜å‚¨åœ¨ç§°ä¸º"é¢‘é“"çš„ä»“åº“ä¸­ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒCondaä¼šä»Anacondaä»“åº“ä¸‹è½½è½¯ä»¶åŒ…ï¼Œä½†ä¹Ÿå¯ä»¥æ·»åŠ å…¶ä»–é¢‘é“ï¼ˆé•œåƒæºï¼Œä¿è¯ç½‘ç»œé€šç•…ï¼‰ï¼Œä»¥è·å–æ›´å¤šè½¯ä»¶åŒ…ã€‚

### åŸºç¡€ä½¿ç”¨ï¼š

1. **å®‰è£…Condaï¼š** é¦–å…ˆï¼Œéœ€è¦å®‰è£…Condaã€‚å¯ä»¥é€‰æ‹©å®‰è£…Anacondaæˆ–Minicondaï¼Œå®ƒä»¬æ˜¯Condaçš„ä¸åŒå‘è¡Œç‰ˆã€‚AnacondaåŒ…å«å¤§é‡çš„é¢„å®‰è£…è½¯ä»¶åŒ…ï¼Œè€ŒMinicondaåªåŒ…å«Condaæœ¬èº«å’Œä¸€äº›åŸºæœ¬å·¥å…·ï¼Œå…è®¸è‡ªå®šä¹‰ç¯å¢ƒï¼ŒæœåŠ¡å™¨ä¸Šçš„è¯ä¸Šä»minicondaä¸Šæ‰‹å°±è¡Œã€‚
    ```bash
    # ä½¿ç”¨Minicondaå®‰è£…
    wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
    bash Miniconda3-latest-Linux-x86_64.sh
    ```

2. **åˆ›å»ºç¯å¢ƒï¼š** ä½¿ç”¨Condaå¯ä»¥è½»æ¾åœ°åˆ›å»ºæ–°ç¯å¢ƒï¼Œä¾‹å¦‚ï¼š
   ```bash
   conda create --name myenv python=3.8
   ```
   è¿™å°†åˆ›å»ºä¸€ä¸ªåä¸º`myenv`çš„æ–°ç¯å¢ƒï¼Œå¹¶åœ¨å…¶ä¸­å®‰è£…Python 3.8ã€‚

3. **æ¿€æ´»ç¯å¢ƒï¼š** è¦è¿›å…¥æˆ–æ¿€æ´»ä¸€ä¸ªç¯å¢ƒï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š
   ```bash
   conda activate myenv
   ```
   æ¿€æ´»ç¯å¢ƒåï¼Œå°†åœ¨å…¶ä¸­è¿è¡Œè½¯ä»¶åŒ…å’ŒPythonã€‚

4. **å®‰è£…è½¯ä»¶åŒ…ï¼š** ä½¿ç”¨Condaå¯ä»¥å®‰è£…æ‰€éœ€çš„è½¯ä»¶åŒ…ï¼Œä¾‹å¦‚ï¼š
   ```bash
   conda install numpy
   ```

   è¿™å°†åœ¨å½“å‰æ¿€æ´»çš„ç¯å¢ƒä¸­å®‰è£…NumPyã€‚

5. **ç®¡ç†ç¯å¢ƒï¼š** å¯ä»¥åˆ—å‡ºå·²åˆ›å»ºçš„ç¯å¢ƒã€å¤åˆ¶ç¯å¢ƒã€åˆ é™¤ç¯å¢ƒç­‰ï¼Œä»¥ç®¡ç†çš„å·¥ä½œç¯å¢ƒã€‚
   ```bash
	$ conda info -e
	
	#å¯¼å‡ºç¯å¢ƒ
	conda env export > environment.yml
	#åˆ é™¤ç¯å¢ƒ
	conda remove --name myenv --all
   ```
   
6. **å¸è½½è½¯ä»¶åŒ…ï¼š** å¦‚æœä¸å†éœ€è¦æŸä¸ªè½¯ä»¶åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¸è½½ï¼š
    ```bash
    conda remove numpy
    ```
    pipå®‰è£…çš„åŒ…æœ€å¥½ç”¨pipæ¥å¸è½½ï¼Œcondaå¸è½½ä¹Ÿéœ€è¦å¤„ç†ä¾èµ–å…³ç³»ï¼Œå¥½æ…¢çš„ã€‚
    
    
**æˆ‘çš„æµ…è–„ç†è§£**ï¼šcondaå…³é”®åœ¨æŠŠä¸åŒçš„è½¯ä»¶æ”¾åœ¨ä¸åŒæ–‡ä»¶å¤¹ä¸‹ï¼Œåˆ‡æ¢ç¯å¢ƒæ—¶æ›´æ–°ç¯å¢ƒå˜é‡ï¼Œè®©æŸäº›ç‰ˆæœ¬ä¼˜å…ˆä½¿ç”¨ã€‚

æ‰€ä»¥æœ‰äº›ä¸å¤ªä¾èµ–ç¯å¢ƒçš„è½¯ä»¶å¯ä»¥ç›´æ¥ç”¨ç»å¯¹è·¯å¾„ä½¿ç”¨ï¼Œä¸éœ€è¦æ¿€æ´»ç¯å¢ƒï¼š

```bash
~/miniconda3/envs/waste/bin/bowtie2 -h
```

æœ‰æ—¶å€™ä¹Ÿå¯ä»¥é€šè¿‡è½¯é“¾æ¥ç»™æŸä¸ªç¯å¢ƒâ€œå®‰è£…â€è½¯ä»¶ã€‚æ³¨æ„é¦–å…ˆè¦æ¸…æ¥šè‡ªå·±çš„ç¯å¢ƒä»¥åŠè¯¥è½¯ä»¶çš„æ€§è´¨ï¼Œæœ‰çš„è½¯ä»¶ä¼šæœ‰ç›¸å¯¹è·¯å¾„çš„ä¾èµ–ï¼Œç®€å•çš„æŠŠbinæ–‡ä»¶ç§»è¿‡å»æ˜¯ä¸è¡Œçš„ï¼š

```bash
ln -s ~/miniconda3/envs/waste/bin/bowtie2 ~/miniconda3/envs/new_env/bin/
```

æˆ‘è§‰å¾—ä¸èƒ½å¤ªè¿‡äºä¾èµ–condaï¼Œè‡ªå·±å¿…é¡»ä¹Ÿè¦æœ‰ä¸€å®šçš„å®‰è£…è½¯ä»¶å’Œç®¡ç†ç¯å¢ƒèƒ½åŠ›ï¼Œæ‰å¯ä»¥æ›´å¥½åœ°é¢å¯¹æœªæ¥å„ç§ç¯å¢ƒé—®é¢˜ğŸ˜‚ã€‚

ç°åœ¨å¥½å¤šè½¯ä»¶éƒ½è¦æ±‚æ–°å»ºä¸€ä¸ªç¯å¢ƒå®‰è£…ï¼Œåšç€åšç€å°±æœ‰å¥½å¤šä¸ªç¯å¢ƒäº†ï¼Œä½†å¯èƒ½å¤§éƒ¨åˆ†é€šç”¨åŒ…æ˜¯å†—ä½™çš„ï¼Œç¡¬ç›˜å ç”¨ä¹Ÿå¤§ã€‚æœ‰æ—¶å€™è‡ªå·±è§‚å¯ŸæŸä¸ªè½¯ä»¶çš„æœ¬ä½“å’Œä¾èµ–é¡¹ï¼Œè¯´ä¸å®šå¤§éƒ¨åˆ†ä¾èµ–é¡¹æˆ‘ä»¬å·²ç»è£…è¿‡äº†ï¼ˆæˆ‘å–œæ¬¢æŠŠç›®æ ‡ç±»ä¼¼çš„è½¯ä»¶æ”¾ä¸€èµ·ï¼Œä¸€èˆ¬ä»–ä»¬çš„ä¾èµ–é¡¹ä¹Ÿæ¯”è¾ƒä¸€è‡´ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨å¤„ç†ã€‚

è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„pythonè„šæœ¬ï¼Œç”¨äºå°†æ‰€æœ‰Condaç¯å¢ƒä¸­å®‰è£…çš„åŒ…æ•´ç†æˆè¡¨æ ¼ï¼Œæ–¹ä¾¿æŸ¥çœ‹ï¼š

```python
import subprocess
import pandas as pd
import os

# è·å–æ‰€æœ‰condaç¯å¢ƒçš„åç§°
def get_conda_envs():
    result = subprocess.run(['conda', 'env', 'list'], stdout=subprocess.PIPE, text=True)
    envs = [line.split()[0] for line in result.stdout.split('\n') if line and not line.startswith('#') and 'envs' in line]
    envs.append('base')
    return envs

# è·å–æŒ‡å®šç¯å¢ƒä¸­çš„åŒ…
def get_packages(env):
    result = subprocess.run(['conda', 'list', '-n', env], stdout=subprocess.PIPE, text=True)
    packages = []
    for line in result.stdout.split('\n')[3:]:  # è·³è¿‡å¤´å‡ è¡Œ
        if line:
            parts = line.split()
            if len(parts) >= 4:
                packages.append((parts[0], parts[1], parts[2], parts[3], env))
    return packages

# è·å–æ‰€æœ‰ç¯å¢ƒçš„åŒ…ä¿¡æ¯
all_packages = []
envs = get_conda_envs()
for env in envs:
    all_packages.extend(get_packages(env))

# è½¬æ¢ä¸ºDataFrameå¹¶ä¿å­˜ä¸ºCSV
df = pd.DataFrame(all_packages, columns=['Package', 'Version', 'Build', 'Channel', 'Environment'])
df.to_csv('conda_packages.csv', index=False)
print("Packages list saved to conda_packages.csv")
```

### ä¸€äº›é—®é¢˜

1. shellè„šæœ¬ä¸­åˆ‡æ¢ç¯å¢ƒ

å¸¸ç”¨çš„`conda activate`åˆ‡æ¢condaç¯å¢ƒçš„æ–¹æ³•åªèƒ½åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ï¼Œæ”¾åœ¨è„šæœ¬ä¸­ä¼šæŠ¥é”™ï¼Œè¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ

å¿…é¡»è¦å…ˆåœ¨è„šæœ¬é‡Œ`source ~/conda.sh`ï¼Œshellè„šæœ¬é‡Œsourceä¸€æ¬¡å°±è¡Œï¼Œå°±å¯ä»¥åˆ‡æ¢å¤šæ¬¡äº†
```bash
source ~/miniconda3/etc/profile.d/conda.sh
conda activate waste
```

2. å®‰è£…é€Ÿåº¦æ…¢æ€ä¹ˆåŠï¼Ÿ

å¯ä»¥ä½¿ç”¨å›½å†…é•œåƒæºï¼š
```bash
conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/
conda config --set show_channel_urls yes
```

3. ä¸ºä»€ä¹ˆä¸å»ºè®®å°†æ‰€æœ‰å†…å®¹å®‰è£…åˆ°baseç¯å¢ƒä¸­ï¼Ÿ

éšç€æ—¶é—´çš„æ¨ç§»ï¼ŒPython æ‰“åŒ…ç³»ç»Ÿå¾ˆå®¹æ˜“å‡ºç°ä¸å…¼å®¹æ€§ï¼›åœ¨ä¸€ä¸ª conda ç¯å¢ƒä¸­å®‰è£…çš„åŒ…è¶Šå¤šï¼Œä¾èµ–å…³ç³»å›¾å°±è¶Šå¤æ‚ï¼Œè¿™ä½¿å¾—é»˜è®¤çš„åŸºæœ¬ç¯å¢ƒåœ¨æ¯æ¬¡å®‰è£…å¦ä¸€ä¸ªåŒ…æ—¶å®¹æ˜“å‡ºç°é—®é¢˜å’ŒæŸåã€‚

å› æ­¤ï¼Œå¼ºçƒˆå»ºè®®ä¸ºæ¯ä¸ªé¡¹ç›®/ç›®çš„ä½¿ç”¨å•ç‹¬çš„ conda ç¯å¢ƒï¼Œä»¥å‡è½» Python æ‰“åŒ…ç³»ç»Ÿçš„ä¾èµ–å…³ç³»ç®¡ç†é—®é¢˜ï¼Œå¹¶ä½¿é¡¹ç›®ä¾èµ–å…³ç³»å°½å¯èƒ½ç‹¬ç«‹å’Œç®€å•ã€‚

